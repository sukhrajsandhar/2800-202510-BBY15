<%- include('templates/header', { cssFiles: ['/styles.css', '/campsite-info.css', '/bookingAvailability.css'] }) %>

<div
    style="
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 0;
        padding-top: 0;
    "
>
    <div style="width: 100%; max-width: 700px; margin: 0 auto">
        <!-- Header Bar with Back and Favourite Buttons -->
        <div
            class="d-flex justify-content-between align-items-center"
            style="gap: 1rem; margin-top: 1rem; margin-bottom: 1rem"
        >
            <a href="/" class="back-link" title="Back to Map">
                <i
                    class="fas fa-arrow-left back-icon"
                    style="font-size: 2rem; color: #283f3b"
                ></i>
            </a>
            <i
                id="heart"
                class="far fa-heart heart-icon"
                style="font-size: 2rem; color: rgb(40, 63, 59); cursor: pointer"
            ></i>
        </div>
        <!-- Banner Image -->
        <div
            style="
                width: 100%;
                height: 260px;
                background: #eee;
                border-radius: 18px;
                overflow: hidden;
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
                display: flex;
                align-items: center;
                justify-content: center;
            "
        >
            <img
                src="<%= campsite.imageUrl || '/default-campsite.jpg' %>"
                id="campsiteImage"
                class="img-fluid w-100 h-100"
                alt="Campsite image"
                style="
                    object-fit: cover;
                    width: 100%;
                    height: 100%;
                    min-height: 180px;
                "
            />
        </div>
        <!-- Details Card -->
        <div class="card shadow-sm p-4 mt-4" style="border-radius: 18px">
            <div
                class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-3"
            >
                <h1 class="mb-2 mb-md-0" style="color: #283f3b">
                    <%= campsite.name %>
                </h1>
            </div>
            <div class="mb-2">
                <i class="fas fa-map-marker-alt"></i>
                <% if (campsite.place_name) { %>
                    <span> <%= campsite.place_name %> </span>
                <% } else { %>
                    <span style="color: #888">No address available</span>
                <% } %>
            </div>
            <div class="mb-2">
                <span class="stars" id="starContainer"></span>
                <span class="ms-2" id="ratingValue">
                    <%= campsite.rating %>
                </span>
            </div>
            <hr />
            <div class="row g-3">
                <div class="col-12">
                    <h5>Description</h5>
                    <p><%= campsite.description %></p>
                    <div class="row g-2">
                        <div class="col-6 col-md-4">
                            <strong>Type:</strong>
                            <%= campsite.type %>
                        </div>
                        <div class="col-6 col-md-4">
                            <strong>Season:</strong>
                            <%= campsite.season %>
                        </div>
                        <div class="col-6 col-md-4">
                            <strong>Difficulty:</strong>
                            <%= campsite.difficulty %>
                        </div>
                        <div class="col-6 col-md-4">
                            <strong>Fees:</strong>
                            <%= campsite.fees && campsite.fees.camping %>
                        </div>
                    </div>
                    <div class="mt-3">
                        <strong>Amenities:</strong>
                        <span>
                            <%= campsite.amenities && campsite.amenities.join(', ') %></span
                        >
                    </div>
                </div>
            </div>
        </div>
        <!-- Bookings Section -->
        <div class="card shadow-sm p-4 mt-4" style="border-radius: 18px">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">Bookings</h2>
                <a
                    href="/createBooking/<%= campsite._id %>"
                    class="btn btn-success"
                    style="background-color: rgb(40, 63, 59)"
                    >New Booking</a
                >
            </div>

            <!-- Booking: List of Bookings for specific campsite -->
            <div class="card-container">
                <% if (bookings && bookings.length > 0) { %> 
                    <% bookings.forEach(function(booking) { %>
                        <div class="card mb-3 p-3">
                            <h4><%= booking.title %></h4>
                            <small
                                ><%= booking.dateStart %> to <%= booking.dateEnd %></small>
                            <p>Availability:</p>
                            <small
                                >People: <%= booking.people %>, Tents: <%= booking.tents %></small
                            >
                            <p><%= booking.summary %></p>
                            <a
                                href="#"
                                class="btn btn-secondary"
                                style="max-width: 20%; align-self: flex-end"
                                >Contact</a
                            >
                        </div>
                    <% }) %> <% } else { %>
                        <div style="color: #888">
                            No bookings available for this campsite yet.
                        </div>
                    <% } %>
            </div>
            <div class="d-flex justify-content-end mt-3">
                <a
                    href="/viewBookings"
                    class="btn btn-outline-primary"
                    style="
                        color: white;
                        background-color: rgb(40, 63, 59);
                        border: #95bf74;
                    "
                    >See All</a
                >
            </div>
        </div>

        <!-- Reviews Section -->
        <div class="card shadow-sm p-4 mt-4" style="border-radius: 18px">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">Reviews</h2>
                <a
                    href="/createReview/<%= campsite._id %>"
                    class="btn btn-success"
                    >New Review</a
                >
            </div>

            <!-- Database Review: List of Reviews for specific campsite -->
            <div class="card-container">
                <% if (review && review.length > 0) { %> 
                    <%review.forEach(function(review) { %>
                        <div class="card mb-3">
                            <div class="card-body">
                                <div
                                    class="d-flex justify-content-between align-items-center mb-2"
                                >
                                    <div class="d-flex align-items-center">
                                        <div
                                            style="
                                                width: 40px;
                                                height: 40px;
                                                background-color: #d0ddd7;
                                                border-radius: 50%;
                                            "
                                        ></div>
                                        <div class="ms-2">
                                    <h6 class="mb-0"><%= review.userId || 'Anonymous' %></h6>
                                    <small class="text-muted"><%= review.overallRating || 'No rating' %></small>
                                </div>
                            </div>
                            <small class="text-muted"><%= review.dateVisited || 'Unknown' %></small>
                        </div>
                        <p class="mb-0">
                            <%= review.additionalComments || 'No comments' %>
                        </p>
                    </div>
                </div>
                <% }) %> <% } else { %>
                <div style="color: #888">
                    No reviews available for this campsite yet.
                </div>
                <% } %>
            </div>
            <!--Hardcoded alert-->
            <div class="card mb-3">
                <div class="card-body">
                    <div
                        class="d-flex justify-content-between align-items-center mb-2"
                    >
                        <div class="d-flex align-items-center">
                            <div
                                style="
                                    width: 40px;
                                    height: 40px;
                                    background-color: #d0ddd7;
                                    border-radius: 50%;
                                "
                            ></div>
                            <div class="ms-2">
                                <h6 class="mb-0">Hiker123</h6>
                                <small class="text-muted"
                                    >Trail Obstruction</small
                                >
                            </div>
                        </div>
                        <small class="text-muted">2025-05-01</small>
                    </div>
                    <p class="mb-0">
                        A large fallen tree is blocking part of the north trail.
                        Caution advised.
                    </p>
                </div>
            </div>

            <div class="d-flex justify-content-end mt-3">
                <a href="/viewReviews" class="btn btn-success btn-sm"
                    >See All</a
                >
            </div>
        </div>

        <!-- Alerts Section -->
        <div class="card shadow-sm p-4 mt-4 mb-5" style="border-radius: 18px">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">Alerts</h2>
                <a
                    href="/createAlert/<%= campsite._id %>"
                    class="btn btn-danger"
                    >New Alert</a
                >
            </div>
            <div class="card-container">
                <% if (alert && alert.length > 0) { %> 
                    <%alert.forEach(function(alert) { %>
                <div
                    style="
                        margin-bottom: 0.5rem;
                        padding: 0.5rem;
                        background-color: #fff3cd;
                        border-radius: 4px;
                    "
                >
                    <strong><%= alert.alertType %></strong>
                    <small class="text-muted"><%= alert.alertDate || 'Unknown' %></small>
                    <%= alert.message %>
                </div>
                <% }) %> <% } else { %>
                <div style="color: #888">
                    No alerts available for this campsite yet.
                </div>
                <% } %>
            </div>
            <div
                style="
                    margin-bottom: 0.5rem;
                    padding: 0.5rem;
                    background-color: #fff3cd;
                    border-radius: 4px;
                "
            >
                <strong>Ranger Notice:</strong> Fire ban in effect until next
                week.
            </div>
            <div class="d-flex justify-content-end mt-3">
                <a href="/viewAlerts" class="btn btn-danger btn-sm">See All</a>
            </div>
        </div>
    </div>

    <script>
        // Heart icon toggle functionality
        const heart = document.getElementById("heart");
        if (heart) {
            heart.addEventListener("click", () => {
                if (heart.classList.contains("far")) {
                    heart.classList.remove("far");
                    heart.classList.add("fas");
                } else {
                    heart.classList.remove("fas");
                    heart.classList.add("far");
                }
            });
        }
        // Star rating functionality
        const rating = parseFloat(
            document.getElementById("ratingValue").textContent
        );
        const starContainer = document.getElementById("starContainer");
        if (starContainer) {
            const fullStars = Math.floor(rating);
            const hasHalf = rating % 1 >= 0.25 && rating % 1 < 0.75;
            const emptyStars = 5 - fullStars - (hasHalf ? 1 : 0);
            for (let i = 0; i < fullStars; i++) {
                starContainer.innerHTML += ' <i class="fas fa-star"></i>';
            }
            if (hasHalf) {
                starContainer.innerHTML +=
                    '<i class="fas fa-star-half-alt"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                starContainer.innerHTML += '<i class="far fa-star"></i>';
            }
        }
    </script>
</div>

<%- include('templates/footer') %>

