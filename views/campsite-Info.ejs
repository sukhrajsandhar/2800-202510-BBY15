<%- include('templates/header', { cssFiles: ['/styles.css', '/footer.css', '/campsite-info.css', '/funFact.css'] }) %>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <main style="display: flex; flex-direction: column; align-items: center; margin-top: 80; padding-top: 0;">
        <div style="width: 100%; max-width: 700px;">
            <!-- Header Bar with Back and Favourite Buttons -->
            <div class="d-flex justify-content-between align-items-center"
                style="gap: 1rem; margin-top: 5rem; margin-bottom: 1rem;">
                <a href="/" class="back-link" title="Back to Map">
                    <i class="fas fa-arrow-left back-icon" style="font-size: 2rem; color: #283f3b;"></i>
                </a>
                <i id="heart" class="far fa-heart heart-icon"
                    style="font-size: 2rem; color: #8212b6; cursor: pointer;" data-campsite-id="<%= campsite._id %>"></i>
            </div>
            <!-- Banner Image -->
                <div class="image-hover-container fade-in-up" style="position: relative; width: 100%; height: 360px; border-radius: 20px; overflow: hidden;">
                <img src="<%= campsite.imageUrl || '/default-campsite.jpg' %>" id="campsiteImage"
                    alt="Campsite image"
                    style="object-fit: cover; width: 100%; height: 100%;" />

                <div class="overlay-title">
                    <%= campsite.name %>
                </div>
                </div>

            <!-- Details Card -->
            <div class="card shadow-sm p-4 mt-4 fade-in-up" style="border-radius: 18px;">
                <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-3">
                    <h1 class="mb-2 mb-md-0" style="color: #283f3b">
                        <%= campsite.name %>
                    </h1>
                </div>
                <div class="mb-2">
                    <i class="fas fa-map-marker-alt"></i>
                    <% if (campsite.place_name) { %>
                        <span>
                            <%= campsite.place_name %>
                        </span>
                        <% } else { %>
                            <span style="color: #888;">No address available</span>
                            <% } %>
                </div>
                <div class="mb-2">
                    <span class="stars" id="starContainer"></span>
                    <span class="ms-2" id="ratingValue">
                        <%= campsite.rating %>
                    </span>
                </div>
                <hr />
                <div class="row g-4 campsite-info">
                    <div class="col-12">
                      <h5 class="section-title">Description</h5>
                      <p><%= campsite.description %></p>
                  
                      <div class="row g-3 mt-2 info-grid">
                        <div class="col-6 col-md-4 info-item">
                          <span class="material-icons">terrain</span>
                          <strong>Type:</strong> <%= campsite.type %>
                        </div>
                        <div class="col-6 col-md-4 info-item">
                          <span class="material-icons">calendar_today</span>
                          <strong>Season:</strong> <%= campsite.season %>
                        </div>
                        <div class="col-6 col-md-4 info-item">
                          <span class="material-icons">fitness_center</span>
                          <strong>Difficulty:</strong> <%= campsite.difficulty %>
                        </div>
                        <div class="col-6 col-md-4 info-item">
                          <span class="material-icons">attach_money</span>
                          <strong>Fees:</strong> <%= campsite.fees && campsite.fees.camping %>
                        </div>
                      </div>
                  
                      <div class="mt-4">
                        <span class="material-icons">emoji_objects</span>
                        <strong>Amenities:</strong>
                        <ul class="columns">
                          <% if (campsite.amenities && campsite.amenities.length > 0) { %>
                            <% campsite.amenities.forEach(function(amenity) { %>
                              <li><%= amenity %></li>
                            <% }) %>
                          <% } else { %>
                            <li>No amenities listed.</li>
                          <% } %>
                        </ul>
                      </div>
                      
                  
                        <span><%= campsite.amenities && campsite.amenities.join(', ') %></span>
                    </div>
                    <!-- Fun Fact Section -->
           <div class="box data-container">
                <!-- Left quote icon -->
                <i class="fas fa-quote-left quote-icon quote-left"></i>

                <div class="quote-content">
                    <h3>
                    <i class="fas fa-lightbulb text-warning" id="revealFunFact" 
                        style="cursor:pointer; filter: grayscale(80%) blur(1px);"
                        title="Click to reveal fun fact"></i> 
                    Fun Fact
                    </h3>
                    <p id="funFact" class="fun-fact-text">
                    Click the lightbulb to reveal the fun fact!
                    </p>
                </div>

                <!-- Right quote icon -->
                <i class="fas fa-quote-right quote-icon quote-right"></i>
                </div>

                    <script>
                        document.addEventListener("DOMContentLoaded", function() {
                            // Fetch the fun fact but keep it hidden initially
                            let funFactText = "";
                            fetch(`/api/funfact/<%= encodeURIComponent(campsite.name) %>`)
                                .then(res => res.json())
                                .then(data => {
                                    funFactText = data.funFact;
                                })
                                .catch(() => {
                                    funFactText = "Could not load fun fact.";
                                });

                            const funFactElem = document.getElementById("funFact");
                            const lightbulb = document.getElementById("revealFunFact");
                            let revealed = false;

                            lightbulb.addEventListener("click", function() {
                                if (!revealed) {
                                    funFactElem.style.filter = "none";
                                    funFactElem.style.userSelect = "auto";
                                    funFactElem.textContent = funFactText || "Could not load fun fact.";
                                    lightbulb.style.filter = "none";
                                    revealed = true;
                                }
                            });
                        });
                    </script>
                </div>
            </div>
        <!-- Bookings Section -->
        <div class="card shadow-sm p-4 mt-4 fade-in-up" style="border-radius: 18px;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">Bookings</h2>
                <a href="/bookingAvailability" class="btn btn-outline-primary">New Booking</a>
            </div>
            <div class="card-container">
                <% if (bookings && bookings.length > 0) { %>
                    <% bookings.forEach(function(booking) { %>
                        <div class="card mb-3 p-3">
                            <h4><%= booking.title %></h4>
                            <small><%= booking.dateStart %> to <%= booking.dateEnd %></small>
                            <p>Availability:</p>
                            <small>People: <%= booking.people %>, Tents: <%= booking.tents %></small>
                            <p><%= booking.summary %></p>
                            <a href="#" class="btn btn-secondary" style="max-width: 20%; align-self: flex-end">Contact</a>
                        </div>
                    <% }) %>
                <% } else { %>
                    <div style="color: #888;">No bookings available for this campsite yet.</div>
                <% } %>
            </div>
        </div>
        <!-- Reviews Section -->
        <div class="card shadow-sm p-4 mt-4 fade-in-up" style="border-radius: 18px;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">Reviews</h2>
                <a href="/createReview/<%= campsite._id %>" class="btn btn-outline-primary">New Review</a>
            </div>
            <div style="margin-bottom: 0.5rem; padding: 0.5rem; background-color: #f9f9f9; border-radius: 4px;">
                <strong>User123:</strong> Beautiful spot! Lots of trees and quiet at night.
            </div>
            <div style="margin-bottom: 0.5rem; padding: 0.5rem; background-color: #f9f9f9; border-radius: 4px;">
                <strong>CamperJane:</strong> Great hiking trails nearby and clean facilities.
            </div>
                <div class="d-flex justify-content-end mt-3">
                <div class="c-button c-button--grow">
                    <a class="button-grow" href="/viewReviews" style="text-decoration: none;">
                    <span class="circle">
                        <span class="icon arrow"></span>
                    </span>
                    <span class="button-text">See All</span>
                    </a>
                </div>
</div>

        </div>

        <!-- Alerts Section -->
        <div class="card shadow-sm p-4 mt-4 mb-5 fade-in-up" style="border-radius: 18px;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">Alerts</h2>
                    <a href="/createAlert/<%= campsite._id %>" class="btn btn-outline-primary">New Alert</a>
            </div>
            <div style="margin-bottom: 0.5rem; padding: 0.5rem; background-color: #fff3cd; border-radius: 4px;">
                <strong>Ranger Notice:</strong> Fire ban in effect until next week.
            </div>
            <div style="margin-bottom: 0.5rem; padding: 0.5rem; background-color: #fff3cd; border-radius: 4px;">
                <strong>Weather Alert:</strong> Heavy rain expected tomorrow, pack accordingly.
            </div>
            <div class="p-button d-flex justify-content-end mt-3">
            <div class="c-button c-button--grow">
                <a class="button-grow " href="/viewAlerts" style="text-decoration: none;">
                <span class="circle">
                    <span class="icon arrow"></span>
                </span>
                <span class="button-text">See All</span>
                </a>
            </div>
</div>

        </div>
    </div>
    <%- include("templates/bg") %>
</main>


<style>
@media (max-width: 700px) {
    .container, .card {
        max-width: 100% !important;
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
    }
    .card {
        padding: 1rem !important;
    }
    .back-link, .heart-icon {
        font-size: 1.5rem !important;
    }
    #campsiteImage {
        border-radius: 12px !important;
        min-height: 120px !important;
        max-height: 200px !important;
    }
    .card-container .card {
        padding: 0.75rem !important;
    }
}
</style>

<script>
    // Heart icon toggle functionality
// Get the heart icon element by its ID
const heart = document.getElementById("heart");

if (heart) {
  heart.addEventListener("click", async () => {
    // Get the campsite ID from a data attribute on the heart element
    const campsiteId = heart.dataset.campsiteId;

    const isAdding = heart.classList.contains("far");

    heart.classList.toggle("far");
    heart.classList.toggle("fas");

    try {
      const response = await fetch(`/favourites/${campsiteId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: isAdding ? "add" : "remove" })
      });

      if (!response.ok) {
        console.error("Failed to update favourites.");
        // If you want, you could toggle back the heart here to show failure
      }
    } catch (error) {
      console.error("Error updating favourites:", error);
      // Optionally toggle back the heart here as well
    }
  });
}

    // Star rating functionality
    const rating = parseFloat(document.getElementById("ratingValue").textContent);
    const starContainer = document.getElementById("starContainer");
    if (starContainer) {
        const fullStars = Math.floor(rating);
        const hasHalf = rating % 1 >= 0.25 && rating % 1 < 0.75;
        const emptyStars = 5 - fullStars - (hasHalf ? 1 : 0);
        for (let i = 0; i < fullStars; i++) {
            starContainer.innerHTML += ' <i class="fas fa-star"></i>';
        }
        if (hasHalf) {
            starContainer.innerHTML += '<i class="fas fa-star-half-alt"></i>';
        }
        for (let i = 0; i < emptyStars; i++) {
            starContainer.innerHTML
            += '<i class="far fa-star"></i>';
        }
    } </script>

 <%- include('templates/footer') %>