<!DOCTYPE html>
<html lang="en">

<head>
  <title><%= title || 'Wildpath' %></title>
  <meta name="comp2800 template" content="My 2800 App">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS and JS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="./booked.css">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>

<body>

  <!-- Navbar placeholder -->
  <%- include('partials/navbar') %>

  <!-- Main title -->
  <h1 class="no-background"><span class="title1"><b>Your Campsites</b></span></h1>
  
  <!-- Tabs navigation -->
  <div class="d-flex justify-content-center">
    <ul class="nav nav-tabs" id="myTab">
      <li class="nav-item">
        <button class="nav-link active" id="booked-tab" data-bs-toggle="tab" data-bs-target="#booked" type="button"
          aria-controls="booked" aria-selected="true"><div class="tent"><label>Booked</label>
          </div></button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button"
          aria-controls="pending" aria-selected="false"><div class="tent">
            <label>Pending </label>
          </div></button>
      </li>
    </ul>
  </div>

  <!-- Tab content -->
  <div class="tab-content p-4">
    <!-- Booked Tab -->
    <div class="tab-pane fade show active" id="booked" aria-labelledby="booked-tab">
      <div class="d-flex flex-column align-items-center">
        <h3 class="text-center mb-4">Your Upcoming Events</h3>
        
        <% if (bookedCampsites && bookedCampsites.length > 0) { %>
          <% bookedCampsites.forEach(function(campsite) { %>
            <div class="card card-hover rounded-4 img-fluid mt-4" style="width:300px">
              <img class="card-img-top" src="<%= campsite.imageUrl || './images/camp.webp' %>" alt="Card image" style="width:100%">
              <div class="card-img-overlay">
                <h4 class="card-title text-white mt-3 mb-4"><%= campsite.name %></h4>
                <ul class="list-group list-group-flush rounded rounded-2">
                  <li class="list-group-item">
                    <span class="material-icons material-symbols-outlined">date_range</span>
                    Date: <%= campsite.date %>
                  </li>
                  <li class="list-group-item">           
                    <span class="material-icons material-symbols-outlined">camping</span>
                    Tent: <%= campsite.tents %></li>
                  <li class="list-group-item">
                    <span class="material-icons material-symbols-outlined">person</span>
                    People: <%= campsite.people %></li>
                </ul>
                <div class="d-flex justify-content-center p-3">
                  <button type="button" class="btn btn-primary" data-bs-toggle="modal" 
                    data-bs-target="#modalBooked" data-campsite-id="<%= campsite.id %>">
                    Cancel Booking
                  </button>
                </div>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <p class="text-center">No booked campsites found.</p>
        <% } %>
      </div>
    </div>
    
    <!-- Modal for Booked -->
    <div class="modal fade" id="modalBooked" tabindex="-1" aria-labelledby="modalBookedLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalBookedLabel">Cancel the Booking</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to cancel the booking?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" id="confirmCancel" class="btn btn-primary">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pending Tab -->
    <div class="tab-pane fade" id="pending" aria-labelledby="pending-tab">
      <div class="d-flex flex-column align-items-center">
        <span class="dot1"></span>
        <h3 class="text-center mb-4">Your Pending Approvals</h3>
        
        <% if (pendingCampsites && pendingCampsites.length > 0) { %>
          <% pendingCampsites.forEach(function(campsite) { %>
            <div class="card img-fluid card-hover rounded-4 mt-4" style="width:300px">
              <img class="card-img-top rounded-4" src="<%= campsite.imageUrl || './images/camp2.webp' %>" alt="Card image" style="width:100%">
              <div class="card-img-overlay">
                <h4 class="card-title text-white mt-3 mb-4"><%= campsite.name %></h4>
                <ul class="list-group list-group-flush bg-white rounded rounded-3">
                  <li class="list-group-item">
                    <span class="material-icons material-symbols-outlined">date_range</span>
                    Date: <%= campsite.date %>
                  </li>
                  <li class="list-group-item">           
                    <span class="material-icons material-symbols-outlined">camping</span>
                    Tent: <%= campsite.tents %></li>
                  <li class="list-group-item">
                    <span class="material-icons material-symbols-outlined">person</span>
                    People: <%= campsite.people %></li>
                </ul>
                <div class="d-flex justify-content-center p-3">
                  <button type="button" class="btn btn-primary" data-bs-toggle="modal" 
                    data-bs-target="#modalPending" data-campsite-id="<%= campsite.id %>">
                    Cancel Booking
                  </button>
                </div>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <p class="text-center">No pending campsites found.</p>
        <% } %>
      </div>
    </div>

    <!-- Modal for Pending -->
    <div class="modal fade" id="modalPending" tabindex="-1" aria-labelledby="modalPendingLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalPendingLabel">Cancel the Booking</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to cancel the booking?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" id="confirmPendingCancel" class="btn btn-primary">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer placeholder -->
  <%- include('partials/footer') %>

  <script>
    // Handle modal confirmation
    document.addEventListener('DOMContentLoaded', function() {
      const modalBooked = document.getElementById('modalBooked');
      const modalPending = document.getElementById('modalPending');
      let currentCampsiteId = null;

      // Booked modal handling
      modalBooked.addEventListener('show.bs.modal', function(event) {
        const button = event.relatedTarget;
        currentCampsiteId = button.getAttribute('data-campsite-id');
      });

      document.getElementById('confirmCancel').addEventListener('click', function() {
        // Handle cancellation for booked campsite
        fetch(`/campsites/${currentCampsiteId}`, {
          method: 'DELETE'
        }).then(response => {
          if (response.ok) {
            window.location.reload();
          }
        });
      });

      // Pending modal handling
      modalPending.addEventListener('show.bs.modal', function(event) {
        const button = event.relatedTarget;
        currentCampsiteId = button.getAttribute('data-campsite-id');
      });

      document.getElementById('confirmPendingCancel').addEventListener('click', function() {
        // Handle cancellation for pending campsite
        fetch(`/campsites/pending/${currentCampsiteId}`, {
          method: 'DELETE'
        }).then(response => {
          if (response.ok) {
            window.location.reload();
          }
        });
      });
    });
  </script>
</body>
</html>